<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario O.R.I.O</title>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/form_perdido.css">
</head>


<div class="star" style="top:5%; left:5%; width:2px; height:2px; animation-duration:1.5s;"></div>
<div class="star" style="top:10%; left:20%; width:1.5px; height:1.5px; animation-duration:2s;"></div>
<div class="star" style="top:15%; left:35%; width:2.5px; height:2.5px; animation-duration:2.2s;"></div>
<div class="star" style="top:20%; left:50%; width:1.8px; height:1.8px; animation-duration:1.8s;"></div>
<div class="star" style="top:25%; left:65%; width:2.2px; height:2.2px; animation-duration:1.9s;"></div>
<div class="star" style="top:30%; left:80%; width:2px; height:2px; animation-duration:2.5s;"></div>
<div class="star" style="top:35%; left:10%; width:1.7px; height:1.7px; animation-duration:2.1s;"></div>
<div class="star" style="top:40%; left:25%; width:2.3px; height:2.3px; animation-duration:2.2s;"></div>
<div class="star" style="top:45%; left:40%; width:2px; height:2px; animation-duration:2.3s;"></div>
<div class="star" style="top:50%; left:55%; width:1.5px; height:1.5px; animation-duration:1.7s;"></div>
<div class="star" style="top:55%; left:70%; width:2px; height:2px; animation-duration:2s;"></div>
<div class="star" style="top:60%; left:85%; width:2.5px; height:2.5px; animation-duration:2.1s;"></div>
<div class="star" style="top:65%; left:5%; width:1.8px; height:1.8px; animation-duration:2.4s;"></div>
<div class="star" style="top:70%; left:20%; width:2.2px; height:2.2px; animation-duration:2.3s;"></div>
<div class="star" style="top:75%; left:35%; width:2px; height:2px; animation-duration:1.8s;"></div>
<div class="star" style="top:80%; left:50%; width:1.5px; height:1.5px; animation-duration:1.9s;"></div>
<div class="star" style="top:85%; left:65%; width:2.3px; height:2.3px; animation-duration:2.2s;"></div>
<div class="star" style="top:90%; left:80%; width:2px; height:2px; animation-duration:2.5s;"></div>
<div class="star" style="top:7%; left:10%; width:1.8px; height:1.8px; animation-duration:1.7s;"></div>
<div class="star" style="top:12%; left:30%; width:2px; height:2px; animation-duration:2.1s;"></div>
<div class="star" style="top:18%; left:45%; width:1.5px; height:1.5px; animation-duration:1.9s;"></div>
<div class="star" style="top:22%; left:60%; width:2.2px; height:2.2px; animation-duration:2.2s;"></div>
<div class="star" style="top:28%; left:75%; width:2px; height:2px; animation-duration:2.3s;"></div>
<div class="star" style="top:33%; left:90%; width:1.7px; height:1.7px; animation-duration:1.8s;"></div>
<div class="star" style="top:37%; left:15%; width:2.3px; height:2.3px; animation-duration:2s;"></div>
<div class="star" style="top:42%; left:35%; width:2px; height:2px; animation-duration:2.1s;"></div>
<div class="star" style="top:48%; left:50%; width:1.5px; height:1.5px; animation-duration:2.4s;"></div>
<div class="star" style="top:52%; left:65%; width:2.2px; height:2.2px; animation-duration:2.3s;"></div>
<div class="star" style="top:58%; left:80%; width:2px; height:2px; animation-duration:1.9s;"></div>
<div class="star" style="top:63%; left:5%; width:1.8px; height:1.8px; animation-duration:2.2s;"></div>
<div class="star" style="top:68%; left:25%; width:2.3px; height:2.3px; animation-duration:2.1s;"></div>
<div class="star" style="top:73%; left:40%; width:2px; height:2px; animation-duration:2.4s;"></div>
<div class="star" style="top:78%; left:55%; width:1.5px; height:1.5px; animation-duration:2s;"></div>
<div class="star" style="top:83%; left:70%; width:2px; height:2px; animation-duration:2.3s;"></div>
<div class="star" style="top:88%; left:85%; width:2.5px; height:2.5px; animation-duration:2.2s;"></div>
<div class="star" style="top:93%; left:10%; width:1.7px; height:1.7px; animation-duration:1.8s;"></div>
<div class="star" style="top:5%; left:40%; width:2.2px; height:2.2px; animation-duration:2.1s;"></div>
<div class="star" style="top:15%; left:60%; width:2px; height:2px; animation-duration:2.4s;"></div>
<div class="star" style="top:25%; left:80%; width:1.5px; height:1.5px; animation-duration:1.9s;"></div>
<div class="star" style="top:35%; left:5%; width:2px; height:2px; animation-duration:2.3s;"></div>
<div class="star" style="top:45%; left:25%; width:2.3px; height:2.3px; animation-duration:2s;"></div>
<div class="star" style="top:55%; left:45%; width:1.8px; height:1.8px; animation-duration:2.1s;"></div>
<div class="star" style="top:65%; left:65%; width:2px; height:2px; animation-duration:2.4s;"></div>
<div class="star" style="top:75%; left:85%; width:2.5px; height:2.5px; animation-duration:2.3s;"></div>
<div class="star" style="top:85%; left:20%; width:1.7px; height:1.7px; animation-duration:1.9s;"></div>
<div class="star" style="top:90%; left:40%; width:2px; height:2px; animation-duration:2.2s;"></div>
<div class="star" style="top:10%; left:70%; width:2.3px; height:2.3px; animation-duration:2s;"></div>
<div class="star" style="top:2%; left:75%; width:1.8px; height:1.8px; animation-duration:1.7s;"></div>
<div class="star" style="top:5%; left:80%; width:2px; height:2px; animation-duration:2s;"></div>
<div class="star" style="top:7%; left:85%; width:2.3px; height:2.3px; animation-duration:2.2s;"></div>
<div class="star" style="top:10%; left:90%; width:1.5px; height:1.5px; animation-duration:1.9s;"></div>
<div class="star" style="top:12%; left:95%; width:2px; height:2px; animation-duration:2.3s;"></div>
<div class="star" style="top:3%; left:78%; width:2.2px; height:2.2px; animation-duration:2s;"></div>
<div class="star" style="top:8%; left:88%; width:1.7px; height:1.7px; animation-duration:2.1s;"></div>
<div class="star" style="top:6%; left:92%; width:2px; height:2px; animation-duration:2.2s;"></div>
<div class="star" style="top:4%; left:83%; width:2.5px; height:2.5px; animation-duration:2.4s;"></div>
<div class="star" style="top:9%; left:97%; width:1.8px; height:1.8px; animation-duration:2s;"></div>
        

<body id="malasPracticas">
    <div class="form-container">
        <div class="form-header">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="form-logo">
            <h1>Registro de Objetos Perdidos</h1>
        </div>

        <form id="reportForm" enctype="multipart/form-data">
            <div class="form-columns">
                <div class="left-column">
                    
                    <label>Nombre del objeto</label>

                     <input type="text" id="nombre_objeto" name="nombre_objeto" maxlength="66" required>

                    <label class="multiple">Estado del objeto</label>
                    <div class="select-wrap">
                        <select id="estado" name="estado" required>
                            <option value="Bueno">Bueno</option>
                            <option value="Regular">Regular</option>
                            <option value="Malo">Malo</option>
                        </select>
                    
                    </div>
                    <label>Color dominante</label>
                     <input type="text" id="color_dominante" name="color_dominante" maxlength="22" required>
                    <label>Lugar donde se perdió</label>
                    <input type="text" name="lugar" required>
                </div>

                <div class="right-column">
                    <label>Fecha de pérdida</label>
                    <input type="date" id="fecha" name="fecha" required>

                    <label>Ficha del aprendiz</label>
                    <input type="integer" id="ficha" name="ficha" required>

                    <label class="multiple">Categoría</label>
                    <div class="select-wrap">
                        <select name="categoria" required>
                            {% if categorias %}
                                {% for cat in categorias %}
                                    <option value="{{ cat.ID_CATEGORIA }}">{{ cat.ID_CATEGORIA }}</option>
                                {% endfor %}
                            {% else %}
                                <option value="">Sin categorías</option>
                            {% endif %}
                        </select>
                    </div>
                    <label>Imagen del objeto (opcional)</label>
                    <input type="file" id="imagen" name="imagen" accept="image/*">
                    <label>Comentario (opcional)</label>
                    <textarea name="comentario" maxlength="1000" placeholder="Detalles adicionales"></textarea>
                </div>
            </div>

            <div class="btn-area">
                <button type="submit">Publicar</button>
                <button type="reset">Limpiar</button>
            </div>

            <div id="MensajeAlerta" style="margin-top:12px;"></div>

        </form> 
    </div>

<script>

    const form = document.getElementById('reportForm');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(form);

        try {
            const response = await fetch('/submit_per', {
                method: 'POST',
                body: formData
            });

            // 1️⃣ Leemos todo como texto SIEMPRE
            const text = await response.text();

            // 2️⃣ Intentamos convertir a JSON
            let result;
            try {
                result = JSON.parse(text);
            } catch (err) {
                console.error("El servidor devolvió HTML en vez de JSON:", text);
                throw new Error("Error 500: La respuesta NO es JSON.");
            }

            // 3️⃣ Si llegamos aquí, TODO está bien
            const mensajeAlerta = document.getElementById('MensajeAlerta');
            mensajeAlerta.innerHTML = result.mensaje || "Datos enviados correctamente";
            mensajeAlerta.style.color = "green";


        } catch (error) {
            const mensajeAlerta = document.getElementById('MensajeAlerta');
            mensajeAlerta.innerHTML = "Error al enviar los datos";
            mensajeAlerta.style.color = "red";
            console.error(error);
        }
    });
</script>

</body>
</html>