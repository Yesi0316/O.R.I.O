<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario O.R.I.O</title>

    <!-- Tipografías Baskerville y Bodoni -->
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&display=swap" rel="stylesheet">

    <style>
        :root {
            --blue-bg: #112250;      /* Azul medio fuerte */
            --gold: #E0C58F;         /* Amarrillo tirando a dorado */
            --white: #ffffff;        /* Botones */
            --font-title: 'Libre Baskerville', serif;
            --font-body: 'Bodoni Moda', serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: -var(-blue-bg);
            font-family: var(--font-body);
            color: var(--gold);
            display: flex;
            justify-content: center;
            padding: 40px;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 18px;
            width: 100%;
            max-width: 750px;
            backdrop-filter: blur(6px);
            border: 1px solid rgba(224, 197, 143, 0.4);
        }

        h1 {
            text-align: center;
            font-family: var(--font-title);
            color: var(--gold);
            letter-spacing: 2px;
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-top: 12px;
            font-size: 15px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--gold);
            background: rgba(255, 255, 255, 0.1);
            color: var(--gold);
            margin-top: 6px;
            font-family: var(--font-body);
        }

        input::placeholder,
        textarea::placeholder
        {
            color: rgba(224, 197, 143, 0.7);
        }

        textarea {
            min-height: 110px;
        }

        .btn-area {
            margin-top: 22px;
            display: flex;
            justify-content: space-between;
        }

        button {
            padding: 10px 18px;
            border-radius: 12px;
            border: 2px solid var(--gold);
            background: var(--white);
            color: var(--blue-bg);
            font-weight: bold;
            font-family: var(--font-body);
            cursor: pointer;
            transition: 0.2s;
        }

        button:hover {
            transform: scale(1.03);
            background: var(--gold);
            color: var(--blue-bg);
        }
        .desplegable {
            font-family: var(--font-body);
            color: black;
            text-size-adjust: 25px;
        }
    </style>
</head>
<body id="malasPracticas">
    <form id="reportForm" action="/submit" method="POST" enctype="multipart/form-data">

            <label>Identificación</label>
        <input type="text" id="identificacion" name="identificacion" maxlength="12" required>

        <label>Nombre del objeto</label>
        <input type="text" id="nombre_objeto" name="nombre_objeto" maxlength="66" required> 

        <label class="multiple">Estado del objeto</label>
        <select id="estado" name="estado" required>
            <option value="Bueno" class="desplegable">Bueno</option>
            <option value="Regular" class="desplegable">Regular</option>
            <option value="Malo" class="desplegable">Malo</option>
        </select>

            <label>Color dominante</label>
            <input type="text" id="color_dominante" name="color_dominante" maxlength="22" required>

            <label>Lugar donde se perdió</label>
            <input type="text" id="lugar" name="lugar" required>

            <label>Fecha de pérdida</label>
            <input type="date" id="fecha" name="fecha" required>

        <label>Ficha del aprendiz</label>
            <input type="integer" id="ficha" name="ficha" required>

            <label class="multiple" >Categoría</label>
            <select name="categoria">
                <option value="1">Tecnología</option>
                <option value="2">Ropa</option>
                <option value="3">Accesorios</option>
                <option value="4">Herramientas</option>
            </select>

            </select>

            <label>Imagen del objeto (opcional)</label>
            <input type="file" id="imagen" name="imagen" accept="image/*">

            <label>Comentario (opcional)</label>
            <textarea id="comentario" name="comentario" maxlength="1000" placeholder="Detalles adicionales"></textarea>

            <div class="btn-area">
                <button type="submit">Publicar</button>
                <button type="reset">Limpiar</button>
            </div>
            <div id="MensajeAlerta" style="margin-top:12px;"></div>
        </form>
        


<script>
    const form = document.getElementById('reportForm');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(form);

        try {
            const response = await fetch('/submit', {
                method: 'POST',
                body: formData
            });

            // 1️⃣ Leemos todo como texto SIEMPRE
            const text = await response.text();

            // 2️⃣ Intentamos convertir a JSON
            let result;
            try {
                result = JSON.parse(text);
            } catch (err) {
                console.error("El servidor devolvió HTML en vez de JSON:", text);
                throw new Error("Error 500: La respuesta NO es JSON.");
            }

            // 3️⃣ Si llegamos aquí, TODO está bien
            const mensajeAlerta = document.getElementById('MensajeAlerta');
            mensajeAlerta.innerHTML = result.mensaje || "Datos enviados correctamente";
            mensajeAlerta.style.color = "green";

            const body = document.querySelector("#malasPracticas");
            const imgg = document.createElement("img");
            imgg.src = result.ruta;
            body.appendChild(imgg);

        } catch (error) {
            const mensajeAlerta = document.getElementById('MensajeAlerta');
            mensajeAlerta.innerHTML = "Error al enviar los datos";
            mensajeAlerta.style.color = "red";
            console.error(error);
        }
    });
</script>

</body>
</html>